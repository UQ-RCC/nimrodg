language: java
jdk: openjdk11
dist: bionic

services:
  - postgresql

addons:
  postgresql: "10"

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -rf $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $TRAVIS_BUILD_DIR/nimrod/build/agents/

before_script:
  - psql -c "CREATE ROLE nimrod LOGIN PASSWORD 'nimrod';" -U postgres
  - psql -c "CREATE DATABASE nimrod OWNER nimrod;" -U postgres

env:
  - >
    NIMRODG_TEST_PGUSER=nimrod
    NIMRODG_TEST_PGPASSWORD=nimrod
    NIMRODG_TEST_PGHOST=127.0.0.1
    NIMRODG_TEST_PGDATABASE=nimrod

script:
  - ./gradlew --no-daemon --info check generateArtifacts

deploy:
  provider: releases
  api_key:
    secure: EZIKib7ApY8+o5IgfplecwA3ioCi8Vza/Y3Ly85jf1F6lw3o6yaEaCw5J8cYp9JbhjYHVMA/eVrqbi77ReGL9W/gNuzvvU0Ca7RVeZ2F0iF/oqXOsD0OpTq+M0U70fyGYgB24oPYih1+4NyZusCWIWn7e3o7DYBc6L3plCR/sF0Q7IF7tIGJ2H3HCU26feSIddVRFCbii6428I4z5nyFcEC2FJAZfT5HOzlhJAmC6oxo8z+Tr3r/UKcZCNx6sSyogrQO32RoFr7Ym1HLJrimoLPutwnjbJYx1FsemtOu7UlV+xdvgwFKfPTSivvFrlr019Eh0DDqSc26GubiONkNwYk93yKC8ZCOUj2BtVvbxFuzG3IwWwf9Apsht5DValy2Htu8CfLaeC28qQJaesOU0ooPAXqyglTh5cAcMcVjB61rvqOj6ssGmCYVY9L807rd2AZrB2SjLZeUwv05QeN9396PW81sR+5ioeDrKJMbean4+nFkOOR71Jccs0IqGNu+oH0KkE18Y+Ajcacc990YCXpNwc4dYkZhMEJxNlA9AhFkWPYyae+P21rjs3QizSN2sYImVJrg9YszbIvb+s1fQ+IG/EoOyJqo6klnJqSI3Tza/iXP38FeXhvBEVvzTtqgsH+SSYWDADVTYER/MSk/fofykvDtMbr6FvLMyV4zwvQ=
  skip_cleanup: true
  file_glob: true
  file:
    - nimrod/build/distributions/nimrod-*.tar.*
    - nimrod/build/distributions/nimrod_*-0ubuntu1_all.deb
    - nimrod/build/distributions/nimrod-*.rpm
  on:
    tags: true
notifications:
  slack:
    secure: a9nDBXalEGIsXZOjX9B7UQj1CcV1rnimdVrS8UdQdjklqEFGFbmjIBO0bh7Rkhx74cUStB410ebcYyrEhe0+snVdrLZd1LFLuUfU2im60KInhlgMKVjlX0sFXjzxuvivj8UhacLEyBzQgGN42RGUPewx3OBS3lQkJLXX5dfxj0BFIh4JFRw+xHDM5c00aUk3AmOyznDOxblt8km5GafPK/sBMcCj7nTMpFEoRcM8Cc/SlQm/splV7PHQWEevPScNZzwknNYLRrm3aE+6F1elsuqd9U06pxK70OVnGxIv39aQ0Xr+yoHvQzyqqjy8xKGIRNzmtHYyQBjyCdhoTKzh0K2NsbHNrBEKfQPunjy1yqkG+8Cbo7A1144nJUl2ERg77bWWWBi3oybCHIpzpKntzzatDNlqW4mQcQ00F2fnPJm8KK9i42VwgfPzuDgdA6cd695IdMLG91zkDvWUHtQIYt8vO3nZw9/uUbWvh8gE7YolbiGMhoG+9VbaJP8zxj09uIHpg42hGiGmkA/YbOZB/yu+drm+p3I/QEtXElM/ZRCfprBRPWJGBnbveXAMGwwk6TrAev3q0X40BTfsKIOJE0Yc6Y3a2EtHd46HIvQCMeIy0g/RdQqP3BWaW8zDmsrO/4C4un3kQSC6pZhGNAhFBYG5q2Fpc5Lblm0NU/NiNX4=
