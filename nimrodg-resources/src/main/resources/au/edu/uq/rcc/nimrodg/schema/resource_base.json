{
	"$schema": "http://json-schema.org/draft-04/schema#",
	"definitions": {
		"tunnel_list": {
			"type": "array",
			"minItems": 0,
			"items": {
				"type": "object",
				"properties": {
					"type": { "enum": ["local", "remote"] },
					"srchost": { "type": "string" },
					"srcport": {
						"type": "integer",
						"minimum": 0,
						"maximum": 65535
					},
					"dsthost": { "type": "string" },
					"dstport": {
						"type": "integer",
						"minimum": 1,
						"maximum": 65535
					}
				},
				"required": ["type", "srchost", "srcport", "dsthost", "dstport"]
			}
		},
		"ssh_resource": {
			"type": "object",
			"properties": {
				"agent_platform": { "type": "string" },
				"transport": {
					"oneOf": [
						{
							"type": "object",
							"properties": {
								"name": { "enum": ["sshd"] },
								"uri": { "type": "string", "format": "uri" },
								"keyfile": { "type": "string" },
								"hostkeys": {
									"type": "array",
									"minItems": 1,
									"items": { "type": "string" }
								},
								"tunnels": { "$ref": "#/definitions/tunnel_list"}
							},
							"required": ["name", "uri", "keyfile", "hostkeys", "tunnels"]
						},
						{
							"type": "object",
							"properties": {
								"name": { "enum": ["openssh"] },
								"uri": { "type": "string" },
								"keyfile": { "type": "string" },
								"executable": { "type": "string" },
								"tunnels": { "$ref": "#/definitions/tunnel_list"}
							},
							"required": ["name", "uri", "keyfile", "executable", "tunnels"]
						}
					]
				}
			},
			"required": ["agent_platform", "transport"]
		},
		"cluster_resource": {
			"allOf": [
				{ "$ref": "#/definitions/ssh_resource" },
				{
					"type": "object",
					"properties": {
						"limit": { "type": "integer", "minimum": 1 },
						"tmpvar": {
							"type": "string",
							"pattern": "^([A-Z_][A-Z0-9+]*)$"
						}
					},
					"required": ["limit", "tmpvar"]
				}
			]
		},
		"batched_cluster_resource": {
			"allOf": [
				{ "$ref": "#/definitions/cluster_resource" },
				{
					"type": "object",
					"properties": {
						"max_batch_size": { "type": "integer", "minimum": 1 },
						"batch_config": {
							"type": "array",
							"minItems": 0,
							"items": {
								"type": "object",
								"properties": {
									"name": {
										"type": "string",
										"pattern": "^([\\w-]+)$"
									},
									"value": { "type": ["string", "integer"] },
									"scale": { "type": "boolean" }
								},
								"additionalProperties": false,
								"required": ["name", "value", "scale"]
							}
						}
					},
					"required": ["max_batch_size", "batch_config"]
				}
			]
		}
	}
}
